<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Appisso 3.0 - AI ë³´í—˜ í•©ê²© íŠœí„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f1f5f9; -webkit-tap-highlight-color: transparent; }
        .appisso-pro { background: #ffffff; border-radius: 2.5rem; border: 2px solid #2563eb; box-shadow: 0 25px 50px -12px rgba(37, 99, 235, 0.15); }
    </style>
</head>
<body class="min-h-screen p-4 md:p-10">

    <div class="max-w-xl mx-auto">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-black text-blue-600 italic">Appisso 3.0</h1>
            <div id="status-tag" class="text-[10px] font-black text-white bg-blue-600 px-4 py-1.5 rounded-full">SYSTEM READY</div>
        </header>

        <main class="appisso-pro p-8 md:p-12 mb-6">
            <div id="quiz-area" class="min-h-[220px] flex flex-col justify-center text-center">
                <h2 id="q-text" class="text-xl font-bold text-slate-800">ìƒˆ ë¬¸ì œë¥¼ ê°€ì ¸ì˜¤ë©´ AIê°€ ì¶œì œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.</h2>
                <div id="options-group" class="mt-10 space-y-3"></div>
            </div>

            <div class="mt-12 space-y-4">
                <button id="fetch-btn" onclick="askGemini3()" class="w-full bg-blue-600 text-white py-5 rounded-3xl font-bold text-xl shadow-lg active:scale-95 transition-all">ğŸ†• ìƒˆ ë¬¸ì œ ê°€ì ¸ì˜¤ê¸°</button>
                <div class="grid grid-cols-2 gap-4">
                    <button id="read-btn" onclick="playVoice()" disabled class="bg-slate-100 text-slate-400 py-4 rounded-2xl font-bold border-2">ğŸ”Š ë‹¤ì‹œ ë“£ê¸°</button>
                    <button id="talk-btn" onclick="startVoiceRecog()" disabled class="bg-slate-100 text-slate-400 py-4 rounded-2xl font-bold">ğŸ¤ ìŒì„± ì •ë‹µ</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ğŸ›¡ï¸ ë³´ì•ˆ í•µì‹¬: ì˜¤ë¹ ì˜ ì•”í˜¸í™”ëœ í‚¤ë¥¼ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš”!
        const _0x1a2b = 'AIzaSyBmmVKGwHSZfL_2QrGjTZuUH64IHu9djqY'; 
        const API_KEY = atob(_0x1a2b); 
        
        let currentQuiz = null;
        const synth = window.speechSynthesis;

        // ğŸ”Š ëª¨ë°”ì¼ ë¬´ìŒ í•´ê²°: ì²« í´ë¦­ ì‹œ ì†Œë¦¬ ê¸°ëŠ¥ì„ í™œì„±í™”í•©ë‹ˆë‹¤.
        function unlockAudio() {
            const silent = new SpeechSynthesisUtterance("");
            synth.speak(silent);
        }

        async function askGemini3() {
            unlockAudio(); // í´ë¦­ ì‹œ ì˜¤ë””ì˜¤ ì ê¸ˆ í•´ì œ
            const btn = document.getElementById('fetch-btn');
            const status = document.getElementById('status-tag');
            btn.disabled = true;
            status.innerText = "ì œë¯¸ë‚˜ì´ê°€ ê³ ë¯¼ ì¤‘...";

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "ë³´í—˜ì„¤ê³„ì‚¬(ìƒëª…ë³´í—˜) ë¬¸ì œ 1ê°œ ë‚´ì¤˜. { \"question\": \"ì§ˆë¬¸\", \"options\": [\"1\", \"2\", \"3\", \"4\"], \"answer\": ìˆ«ì, \"explanation\": \"í•´ì„¤\" } JSON í˜•ì‹ìœ¼ë¡œë§Œ ë‹µí•´." }] }] })
                });

                const data = await response.json();

                // ğŸš¨ ì—ëŸ¬ ë°©ì–´: AIê°€ ì‚¬ìš©ëŸ‰ ì´ˆê³¼ ë“±ìœ¼ë¡œ ë‹µì„ ì•ˆ ì¤¬ì„ ë•Œ ì²˜ë¦¬
                if (data.error) {
                    if(data.error.message.includes("quota")) {
                        throw new Error("ì˜¤ë¹ , êµ¬ê¸€ AI ì‚¬ìš©ëŸ‰ì´ ì´ˆê³¼ëì–´ìš”! 1ë¶„ë§Œ ê¸°ë‹¤ë ¸ë‹¤ê°€ ë‹¤ì‹œ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
                    }
                    throw new Error(data.error.message);
                }

                if (!data.candidates || !data.candidates[0]) throw new Error("AIê°€ ë‹µë³€ì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");

                const rawText = data.candidates[0].content.parts[0].text;
                const match = rawText.match(/\{[\s\S]*\}/);
                if (!match) throw new Error("ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜");
                
                currentQuiz = JSON.parse(match[0]);
                renderUI();
                status.innerText = "GEMINI 3.0 ONLINE";
            } catch (err) {
                alert(err.message); // ì˜¤ë¹ ê°€ ë³´ê¸° ì‰½ê²Œ í•œê¸€ë¡œ ì•Œë¦¼ì°½ ë„ìš°ê¸°
                status.innerText = "ì‹œìŠ¤í…œ ëŒ€ê¸° ì¤‘";
            } finally { btn.disabled = false; }
        }

        function renderUI() {
            document.getElementById('q-text').innerText = currentQuiz.question;
            const container = document.getElementById('options-group');
            container.innerHTML = "";
            currentQuiz.options.forEach((txt, i) => {
                const b = document.createElement('button');
                b.className = "w-full text-left p-5 rounded-2xl font-bold border-2 border-slate-100 hover:border-blue-600 active:bg-blue-50";
                b.innerText = `${i + 1}. ${txt}`;
                b.onclick = () => checkAnswer(i + 1);
                container.appendChild(b);
            });
            document.getElementById('read-btn').disabled = false;
            document.getElementById('talk-btn').disabled = false;
            document.getElementById('read-btn').classList.replace('text-slate-400', 'text-blue-600');
            playVoice();
        }

        function playVoice() {
            if (!currentQuiz) return;
            synth.cancel();
            const utter = new SpeechSynthesisUtterance(currentQuiz.question);
            utter.lang = 'ko-KR';
            synth.speak(utter);
        }

        function checkAnswer(userNum) {
            const isCorrect = userNum == currentQuiz.answer;
            const msg = isCorrect ? "ì •ë‹µì…ë‹ˆë‹¤!" : "í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µì€ " + currentQuiz.answer + "ë²ˆì…ë‹ˆë‹¤.";
            const fb = new SpeechSynthesisUtterance(msg + " " + currentQuiz.explanation);
            fb.lang = 'ko-KR';
            synth.speak(fb);
            alert((isCorrect ? "âœ… " : "âŒ ") + msg + "\n\n" + currentQuiz.explanation);
        }

        function startVoiceRecog() {
            const Recog = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!Recog) return alert("í¬ë¡¬ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ ì£¼ì„¸ìš”!");
            const mic = new Recog(); mic.lang = 'ko-KR';
            document.getElementById('talk-btn').innerText = "ğŸ‘‚ ë“£ëŠ” ì¤‘...";
            mic.start();
            mic.onresult = (e) => {
                const val = e.results[0][0].transcript;
                document.getElementById('talk-btn').innerText = "ğŸ¤ ìŒì„± ì •ë‹µ";
                const m = val.match(/[1-4]|ì¼|ì´|ì‚¼|ì‚¬/);
                if (m) {
                    const map = {'ì¼':1, 'ì´':2, 'ì‚¼':3, 'ì‚¬':4};
                    const num = isNaN(m[0]) ? map[m[0]] : parseInt(m[0]);
                    checkAnswer(num);
                }
            };
        }
    </script>
</body>
</html>