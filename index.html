<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Appisso 3.0 - AI ë³´í—˜ íŠœí„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f0f4f8; -webkit-tap-highlight-color: transparent; }
        .appisso-pro { background: #ffffff; border-radius: 2rem; border: 2px solid #3b82f6; box-shadow: 0 20px 25px -5px rgba(59, 130, 246, 0.1); }
    </style>
</head>
<body class="min-h-screen p-4 md:p-10 text-slate-900">

    <div class="max-w-xl mx-auto">
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-black text-blue-700 italic tracking-tighter">Appisso 3.0</h1>
                <p class="text-[10px] font-black text-blue-400">GEMINI 3.0 AI ENGINE</p>
            </div>
            <button onclick="window.print()" class="bg-blue-700 text-white px-4 py-2 rounded-xl text-sm font-bold shadow-md">ì¸ì‡„</button>
        </header>

        <main class="appisso-pro overflow-hidden mb-6">
            <div id="loading-bar" class="h-1.5 bg-blue-600 w-0 transition-all duration-700"></div>
            
            <div class="p-8">
                <div id="status-tag" class="mb-6 text-center text-[10px] font-black text-white bg-blue-600 inline-block px-4 py-1 rounded-full w-full">SYSTEM ONLINE</div>
                
                <div id="quiz-area" class="min-h-[250px] flex flex-col justify-center text-center">
                    <h2 id="q-text" class="text-2xl font-bold leading-snug text-slate-800">
                        "ìƒˆ ë¬¸ì œ ê°€ì ¸ì˜¤ê¸°" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´<br>ì œë¯¸ë‚˜ì´ 3.0ì´ ì¶œì œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤!
                    </h2>
                    <div id="options-group" class="mt-8 space-y-3"></div>
                </div>

                <div class="mt-10 space-y-3">
                    <button id="fetch-btn" onclick="askGemini3()" class="w-full bg-blue-700 text-white py-5 rounded-2xl font-bold text-xl shadow-xl active:scale-95 transition">
                        ğŸ†• ìƒˆ ë¬¸ì œ ê°€ì ¸ì˜¤ê¸°
                    </button>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <button id="read-btn" onclick="playVoice()" disabled class="bg-slate-100 text-slate-400 py-4 rounded-xl font-bold">ğŸ”Š ë‹¤ì‹œ ë“£ê¸°</button>
                        <button id="talk-btn" onclick="startVoiceRecog()" disabled class="bg-slate-100 text-slate-400 py-4 rounded-xl font-bold">ğŸ¤ ìŒì„± ì •ë‹µ</button>
                    </div>
                </div>
            </div>
        </main>

        <section class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
            <h3 class="font-bold text-slate-600 mb-4 border-b pb-2">ğŸ“ ì‹¤ì‹œê°„ í•™ìŠµ ê¸°ë¡</h3>
            <div id="history-box" class="space-y-3 text-sm text-slate-500">
                <p class="text-center italic">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </section>
    </div>

    <script>
        // ---------------------------------------------------------
        // ğŸ”‘ ì˜¤ë¹ ! ë°œê¸‰ë°›ì€ API í‚¤ë¥¼ ì—¬ê¸°ì— ì •í™•íˆ ë„£ì–´ì£¼ì„¸ìš”.
        const API_KEY = 'AIzaSyCwP2doi0hF0K49fBFgxicSwrEGaVA2_wY'; 
        // ---------------------------------------------------------

        let currentQuiz = null;
        const synth = window.speechSynthesis;

        async function askGemini3() {
            const btn = document.getElementById('fetch-btn');
            const status = document.getElementById('status-tag');
            const bar = document.getElementById('loading-bar');
            
            btn.disabled = true;
            status.innerText = "GEMINI 3.0 THINKING...";
            bar.style.width = "70%";

            const prompt = "ë³´í—˜ì„¤ê³„ì‚¬(ìƒëª…ë³´í—˜) ìê²©ì‹œí—˜ ë¬¸ì œë¥¼ 1ê°œ ë‚´ì¤˜. { \"question\": \"ì§ˆë¬¸\", \"options\": [\"1\", \"2\", \"3\", \"4\"], \"answer\": ìˆ«ì, \"explanation\": \"í•´ì„¤\" } ì´ JSON í˜•ì‹ìœ¼ë¡œë§Œ ë‹µí•´.";

            try {
                // ğŸ› ï¸ ìµœì‹  ì œë¯¸ë‚˜ì´ 3.0 ê²½ë¡œì™€ ëª¨ë¸ëª… ì‚¬ìš©
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                const data = await response.json();
                
                // ğŸš¨ ì—ëŸ¬ ë°©ì–´ ì½”ë“œ (Undefined ì—ëŸ¬ ë°©ì§€)
                if (data.error) throw new Error(data.error.message);
                if (!data.candidates || !data.candidates[0]) throw new Error("AI ì‘ë‹µ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");

                const rawText = data.candidates[0].content.parts[0].text;
                const match = rawText.match(/\{[\s\S]*\}/);
                if (!match) throw new Error("JSON íŒŒì‹± ì˜¤ë¥˜");
                
                currentQuiz = JSON.parse(match[0]);
                
                renderUI();
                status.innerText = "ì¶œì œ ì„±ê³µ (3.0)";
                bar.style.width = "100%";
                setTimeout(() => bar.style.width = "0%", 500);
            } catch (err) {
                console.error(err);
                alert("ì˜¤ë¹ , ì—ëŸ¬ê°€ ë‚¬ì–´ìš”: " + err.message);
                status.innerText = "ERROR OCCURRED";
            } finally {
                btn.disabled = false;
            }
        }

        function renderUI() {
            document.getElementById('q-text').innerText = currentQuiz.question;
            const container = document.getElementById('options-group');
            container.innerHTML = "";
            
            currentQuiz.options.forEach((txt, i) => {
                const b = document.createElement('button');
                b.className = "w-full text-left p-4 border-2 border-slate-100 rounded-xl hover:border-blue-600 hover:bg-blue-50 transition font-bold";
                b.innerText = `${i + 1}. ${txt}`;
                b.onclick = () => checkAnswer(i + 1);
                container.appendChild(b);
            });

            const rBtn = document.getElementById('read-btn');
            const tBtn = document.getElementById('talk-btn');
            [rBtn, tBtn].forEach(b => {
                b.disabled = false;
                b.classList.remove('bg-slate-100', 'text-slate-400');
                b.classList.add(b.id === 'read-btn' ? 'bg-white' : 'bg-green-600', b.id === 'read-btn' ? 'text-blue-700' : 'text-white');
            });
            
            playVoice();
        }

        // ğŸ”Š ëª¨ë°”ì¼ì—ì„œ ì†Œë¦¬ê°€ ì˜ ë‚˜ì˜¤ê²Œ í•˜ëŠ” í•µì‹¬ ì½”ë“œ
        function playVoice() {
            if (!currentQuiz) return;
            synth.cancel(); // ì§„í–‰ì¤‘ì¸ ìŒì„± ì·¨ì†Œ

            const utter = new SpeechSynthesisUtterance(currentQuiz.question);
            utter.lang = 'ko-KR';
            utter.rate = 1.0;
            
            // ëª¨ë°”ì¼ ë¸Œë¼ìš°ì €ì˜ íŠ¹ì„±ì„ ê³ ë ¤í•œ ëª…ì‹œì  ì‹¤í–‰
            window.speechSynthesis.speak(utter);
        }

        function startVoiceRecog() {
            const Recog = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!Recog) return alert("í¬ë¡¬ ë¸Œë¼ìš°ì €ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”!");
            
            const mic = new Recog();
            mic.lang = 'ko-KR';
            document.getElementById('talk-btn').innerText = "ğŸ‘‚ ë“£ëŠ” ì¤‘...";
            mic.start();

            mic.onresult = (e) => {
                const val = e.results[0][0].transcript;
                document.getElementById('talk-btn').innerText = "ğŸ¤ ìŒì„± ì •ë‹µ";
                const m = val.match(/[1-4]|ì¼|ì´|ì‚¼|ì‚¬/);
                if (m) {
                    const map = {'ì¼':1, 'ì´':2, 'ì‚¼':3, 'ì‚¬':4};
                    const num = isNaN(m[0]) ? map[m[0]] : parseInt(m[0]);
                    checkAnswer(num);
                }
            };
        }

        function checkAnswer(userNum) {
            const isCorrect = userNum == currentQuiz.answer;
            const feedback = isCorrect ? "ì •ë‹µì…ë‹ˆë‹¤!" : `í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µì€ ${currentQuiz.answer}ë²ˆì…ë‹ˆë‹¤.`;
            
            // í•´ì„¤ê¹Œì§€ ì½ì–´ì£¼ê¸°
            const feedbackUtter = new SpeechSynthesisUtterance(feedback + " " + currentQuiz.explanation);
            feedbackUtter.lang = 'ko-KR';
            synth.speak(feedbackUtter);

            alert(`${isCorrect ? 'âœ…' : 'âŒ'} ${feedback}\n\n${currentQuiz.explanation}`);
            
            const box = document.getElementById('history-box');
            if (box.innerText.includes("ì•„ì§ ê¸°ë¡ì´")) box.innerHTML = "";
            const div = document.createElement('div');
            div.className = `p-3 rounded-lg border-l-4 ${isCorrect ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'}`;
            div.innerHTML = `<strong>${isCorrect ? 'PASS' : 'FAIL'}</strong> ${currentQuiz.question.substring(0,20)}...`;
            box.prepend(div);
        }
    </script>
</body>
</html>